name: Build, Test, and Deploy for Prod Branch

on:
  push:
    branch:
      - prod

jobs:
  build:
    runs-on: self-hosted
    defaults:
      run:
        working-directory: /var/www/aihomework/prod

    steps:
      - name: Pull from github
        id: pull
        run: |
          git pull origin prod
      - name: install dependencies
        run: yarn install
      - name: buld the dist
        run: yarn build
      - name: setup service file
        run: sudo cp server-script/aihomeworkprod.service /etc/systemd/system
      - name: start the app
        run: |
          sudo systemctl daemon-reload
          sudo systemctl restart aihomeworkprod

  # test:
  #   -name: Run test
  #   run: yarn jest

  # deploy:
  #   runs-on: self-hosted
  #     needs: build
  #     if: github.ref == 'refs/heads/dev'

  #     steps:
  #       - name: Install dependencies
  #         run: yarn install
